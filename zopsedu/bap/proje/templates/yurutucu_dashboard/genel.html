{% extends "base.html" %}

{% block context %}

    <div class="content-header row">
        <div class="content-header-left col-md-8 col-12 mb-2">
            <h3 class="content-header-title mb-0 d-inline-block">  {{ _("Kontrol Paneli") }} </h3>
        </div>
    </div>
    <div class="content-body">
        <section class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-head"></div>
                    <div id="project-info" class="card-body">
                        <div class="row">
                            <div class="col-xl-3 col-lg-6 col-12">
                                <div class="card bg-info bg-darken-3">
                                    <div class="card-content">
                                        <div class="card-body">
                                            <div class="media d-flex">
                                                <div class="align-self-center">
                                                    <i class="icon-pencil text-white font-large-2 float-left"></i>
                                                </div>
                                                <div class="media-body text-white text-right">
                                                    <h3 class="text-white"> {{ devam_eden_proje_sayisi }}</h3>
                                                    <span>{{ _('Devam Eden Projeler') }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-12">
                                <div class="card bg-danger bg-darken-3">
                                    <div class="card-content">
                                        <div class="card-body">
                                            <div class="media d-flex">
                                                <div class="align-self-center">
                                                    <i class="icon-speech text-white font-large-2 float-left"></i>
                                                </div>
                                                <div class="media-body text-white text-right">
                                                    <h3 class="text-white">{{ tamamlanan_proje_sayisi }}</h3>
                                                    <span>{{ _('Tamamlanan Projeler') }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-12">
                                <div class="card bg-success bg-darken-3">
                                    <div class="card-content">
                                        <div class="card-body">
                                            <div class="media d-flex">
                                                <div class="align-self-center">
                                                    <i class="icon-graph text-white font-large-2 float-left"></i>
                                                </div>
                                                <div class="media-body text-white text-right">
                                                    <h3 class="text-white">{{ toplam_butce }}</h3>
                                                    <span>{{ _('Toplam Bütçe') }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-12">
                                <div class="card bg-warning bg-darken-3">
                                    <div class="card-content">
                                        <div class="card-body">
                                            <div class="media d-flex">
                                                <div class="align-self-center">
                                                    <i class="icon-pointer text-white font-large-2 float-left"></i>
                                                </div>
                                                <div class="media-body text-white text-right">
                                                    <h3 class="text-white">{{ harcanan_butce }}</h3>
                                                    <span>{{ _('Harcanan Bütçe') }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- project-info -->
                    <div class="card-body">
                        <div class="card-subtitle line-on-side text-muted text-center font-small-3 mx-2 my-1">
                        </div>
                        <div class="row py-2">
                            <div class="col-lg-6 col-md-12">
                                <div class="insights px-2">
                                    <div><span
                                            class="text-info h3">{{ tamamlanan_proje_sayisi / (devam_eden_proje_sayisi + tamamlanan_proje_sayisi if devam_eden_proje_sayisi + tamamlanan_proje_sayisi else 1) * 100 }}%</span>
                                        <span class="float-right">{{ _('Genel Proje Özeti') }}</span>
                                    </div>
                                    <div class="progress progress-md mt-1 mb-0">
                                        <div class="progress-bar bg-info" role="progressbar"
                                             style="width:{{ tamamlanan_proje_sayisi / (devam_eden_proje_sayisi + tamamlanan_proje_sayisi if devam_eden_proje_sayisi + tamamlanan_proje_sayisi else 1) * 100 }}%;"
                                             aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="insights px-2">
                                    <div><span
                                            class="text-success h3">{{ (toplam_butce - harcanan_butce) / (toplam_butce if toplam_butce != 0 else 1) * 100 }}%</span>
                                        <span class="float-right">{{ _('Genel Bütçe Özeti') }}</span></div>
                                    <div class="progress progress-md mt-1 mb-0">
                                        <div class="progress-bar bg-success" role="progressbar"
                                             style="width: {{ (toplam_butce - harcanan_butce) / (toplam_butce if toplam_butce != 0 else 1) * 100  }}%"
                                             aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="card">
            <div class="card-body">
                <div id="accordionWrap3" role="tablist" aria-multiselectable="true">
                    <div class="card collapse-icon accordion-icon-rotate">
                        <div id="heading31" class="card-header collapse-bg-color mt-1">
                            <a data-toggle="collapse" data-parent="#accordionWrap3" href="#accordion31"
                               aria-expanded="true"
                               aria-controls="accordion31" class="card-title lead white">{{ _('Proje Mesajları') }}</a>
                        </div>
                        <div id="accordion31" role="tabpanel" aria-labelledby="heading31"
                             class="card-collapse collapse show"
                             aria-expanded="true" style="">
                            <div class="card-content">
                                <div class="card-body">
                                    <table id="data-table-proje-mesajlari"
                                           class="table table-striped table-bordered dataTable no-footer dtr-inline"
                                           role="grid"
                                           aria-describedby="data-table_info" style="width: 100%">
                                        <thead>
                                        <tr role="row">
                                            <th>
                                                {{ _("#") }}
                                            </th>
                                            <th>
                                                {{ _("Proje Başlığı") }}
                                            </th>
                                            <th>
                                                {{ _("Mesaj Başlığı") }}
                                            </th>
                                            <th>
                                                {{ _("Gönderen Kişi") }}
                                            </th>
                                            <th>
                                                {{ _("Gönderim Tarihi") }}
                                            </th>
                                            <th>
                                                {{ _("Okundu") }}
                                            </th>
                                            <th>
                                                {{ _("Gelen Kutusu") }}
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for mesaj in proje_mesajlari %}
                                            <tr class="odd" role="row">
                                                <td>
                                                    {{ loop.index }}
                                                </td>
                                                <td>
                                                    {{ mesaj.proje_basligi }}
                                                </td>
                                                <td>
                                                    {{ mesaj.baslik }}
                                                </td>
                                                <td>
                                                    {{ mesaj.gonderen_ad + " " + mesaj.gonderen_soyad }}
                                                </td>
                                                <td>
                                                    {{ '{:%d.%m.%Y}'.format(mesaj.gonderim_zamani) if mesaj.gonderim_zamani else "-" }}
                                                </td>
                                                <td>
                                                    {{ _("Evet") if mesaj.okundu else _("Hayır") }}
                                                </td>
                                                <td>
                                                    <a href="{{ url_for('proje.proje_mesajlari', proje_id=mesaj.proje_id) }}">
                                                        <span class="fa fa-arrow-circle-right fa-2x "></span></a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div id="heading32" class="card-header collapse-bg-color mt-1">
                            <a data-toggle="collapse" data-parent="#accordionWrap3" href="#accordion32"
                               aria-expanded="true"
                               aria-controls="accordion32"
                               class="card-title lead white collapsed">{{ _('İşlem Geçmişi') }}</a>
                        </div>
                        <div id="accordion32" role="tabpanel" aria-labelledby="heading32"
                             class="card-collapse collapse show"
                             aria-expanded="true" style="">
                            <div class="card-content">
                                <div class="card-body">
                                    <table id="data-table-islem-gecmisi"
                                           class="table table-striped table-bordered dataex-html5-selectors dataTable"
                                           role="grid"
                                           aria-describedby="data-table_info" style="width: 100%">
                                        <thead>
                                        <tr role="row">
                                            <th>{{ _("#") }}</th>
                                            <th>{{ _("Proje Başlığı") }}</th>
                                            <th>{{ _("Durum Kodu") }}</th>
                                            <th>{{ _("Açıklama") }}</th>
                                            <th>{{ _("İşlemi Yapan") }}</th>
                                            <th>{{ _("İşlemin Yapılma Tarihi") }}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for islem in islem_gecmisi %}
                                            <tr class="odd" role="row">
                                                <td> {{ loop.index }}</td>
                                                <td> {{ islem.proje_basligi }} </td>
                                                <td>{{ islem.state_code }}</td>
                                                <td>{{ islem[0].description }}</td>
                                                <td>{{ islem.ad + " " + islem.soyad }}</td>
                                                <td>{{ islem[0].date.strftime("%d.%m.%Y") }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div id="heading33" class="card-header collapse-bg-color mt-1">
                            <a data-toggle="collapse" data-parent="#accordionWrap3" href="#accordion33"
                               aria-expanded="true"
                               aria-controls="accordion33"
                               class="card-title lead white collapsed">{{ _('BAP Duyuruları') }}</a>
                        </div>
                        <div id="accordion33" role="tabpanel" aria-labelledby="heading33"
                             class="card-collapse collapse show"
                             aria-expanded="true">
                            <div class="card-content">
                                <div class="card-body">
                                    <table id="data-table-bap-duyurulari"
                                           class="table table-striped table-bordered dataTable no-footer dtr-inline"
                                           role="grid"
                                           aria-describedby="data-table_info" style="width: 100%">
                                        <thead>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for duyuru in bap_duyurular %}
                                            <tr>
                                                <td> {{ duyuru.baslik }} </td>
                                                <td>
                                                    <a href="{{ url_for("anasayfa.bap_duyuru_detay", duyuru_id=duyuru.id) }}">
                                                        <span class="fa fa-arrow-circle-right fa-2x "></span>
                                                    </a>
                                                </td>
                                            </tr>
                                        {% else %}
                                            <tr id="empty-row">
                                                <td colspan="3">{{ _("Henüz duyuru eklenmedi.") }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% from 'macros/utils/dataTables/table_manage.html' import table_manage_buttons_init_without_search_without_buttons %}
    {{ table_manage_buttons_init_without_search_without_buttons(id="data-table-proje-mesajlari") }}
    {{ table_manage_buttons_init_without_search_without_buttons(id="data-table-islem-gecmisi") }}

{% endblock %}